var BookReader=function(e,t,i,o){void 0!=e&&null!=e&&(this.site=e),void 0!=t&&null!=t&&(this.page=t),void 0!=i&&null!=i&&(this.referer=i),void 0!=o&&null!=o&&(this.uid=o)};BookReader.prototype.setPage=function(e){this.page=e},BookReader.prototype.setPageName=function(e){this.pageName=e},function(e,t,i){function o(){new BookReader}var n=window.BOOK||{};n.Namespace={register:function(e){var t,i,o=e.split("."),n=window;for(i=0,t=o.length;t>i;i++)"undefined"==typeof n[o[i]]&&(n[o[i]]={}),n=n[o[i]];return n}},n.Utils={checkPhone:function(e){var t=/^1[3|4|5|7|8][0-9]\d{8}$/;return t.test(e)?!0:!1}},function(){var e,t=i("head");e=t.data("page"),o(e)}(),window.BOOK=n,window.B=n.Utils}(window,document,Zepto,"注册全局事件"),BOOK.Namespace.register("book.search.component"),function(e,t){t.SearchModule=function(t){this.elem={hideSearP:e(".cancel_moudle"),searPage:e(".search_page"),list:e(".linklist"),listDetail:e(".linklistdetail"),input:e(".form_moudle").find("input[type=text]"),topbar:e(".sear_moudle"),content:e(".pageContent"),result:e(".search-result"),esfDefault:e(".esfDefault"),esfHistory:e(".esfHistory")};var i={data:{}};this.nowkeyw="",this.page=1,this.options=e.extend({},i,t||{}),this.init()},t.SearchModule.prototype={init:function(){this.event(),this.setScroll(),0!==e(".noresult").length&&e("#list").css("margin-top","38px")},setScroll:function(){var t=e(window).height()-this.elem.topbar.height()+"px";this.elem.content.css({"max-height":t,"overflow-y":"scroll"})},event:function(){var t=this;this.options.target.select.forEach(function(i){e(i).on(t.options.target.event,function(){t.getHistory(),t.elem.searPage.show(),e("#searchHide").hide(),t.elem.input.focus()})}),this.elem.hideSearP.on("click",function(){t.elem.searPage.hide(),e("#searchHide").show()}),e(".form_moudle").on("submit",function(){var i=e.trim(t.elem.input.val());if(!(i.length<=0))return e("#searchHide").show(),t.redirect(i),!1}),this.elem.content.on("click","a",function(t){t.preventDefault(),window.location.href=e(this).attr("href"),e("#searchHide").show()}),this.elem.input.on("input",function(){var i=e(this);clearTimeout(t.timer),t.timer=setTimeout(function(){var o=e.trim(i.val());0===o.length?(t.elem.content.show(),t.elem.result.hide()):t.getSuggest(o)},50)})},redirect:function(e){this.redirectEvent(e)},redirectEvent:function(e){var t,i,o=this.options.searchurl?this.options.searchurl:this.options.url,n=o.indexOf("?"),s=[],r=0>n?o:o.substring(0,n);if(n>0){i=o.substring(n).replace("?","").split("&");for(t in i)0!==i[t].indexOf("q=")&&""!==i[t]&&s.push(i[g])}return s.push("q="+encodeURIComponent(e)),this.hrefReplace===!0?void location.replace(r+"?"+s.join("&")):void(location.href=r+"?"+s.join("&"))},buildItem:function(e,t){var i=this.encodeHtml(e.keyword),o=this.encodeHtml(e.description);return oStr=this.encodeHtml(t),i=this.buildHigh(i,oStr),o=this.buildHigh(o,oStr),'<li><a href="'+e.url+"?q="+e.keyword+'" class="soj" data-soj="'+e.from_code+'"><span class="elli">'+i+'</span><br/><span class="elli">'+o+"</span></li>"},buildHigh:function(e,t){var i;return t&&(i=new RegExp(t,"g"),e=e.replace(i,function(){return"<em>"+arguments[0]+"</em>"})),e},encodeHtml:function(t){return"string"!==e.type(t)||0===t.lenght?"":(t=t.replace(/&/g,"&gt;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\'/g,"&#39;"),t=t.replace(/\"/g,"&quot;"))},getHistory:function(){var t=this;e.ajax({url:t.options.suggest,type:"get",dataType:"jsonp",jsonp:"callback",data:{city_id:t.options.cityid,form:t.page},success:function(i){t.elem.esfHistory.html("");for(var o in i.data)e.isArray(i.data[o])&&t.buildHistory(i.data[o],o)},error:function(){console.log("error")}})},buildHistory:function(t,i){var o=[],n=this;e.each(t,function(e,t){o.push(n.buildHistoryItem(t||{}))});var s=o.join("");switch(i){case"default":s='<h3>热门搜索：</h3><div class="hot_moudle">'+s+"</div>",this.elem.esfHistory.hide(),this.elem.esfDefault.html(s);break;case"searched":s='<h3>搜索历史</h3><div class="history_dom"><div class="history_moudle">'+s+"</div></div>",this.elem.esfDefault.hide(),this.elem.esfHistory.append(s)}},buildHistoryItem:function(e){var t=this.encodeHtml(e.keyword);return'<a href="'+e.url+"?q="+e.keyword+'" class="soj" data-soj="'+e.form_code+'">'+t+"</a>"},getSuggest:function(t){{var i=this;e.extend({keywords:t},i.options.data||{})}this.nowkeyw=e.trim(i.elem.input.val()),e.ajax({url:i.options.suggest,type:"get",dataType:"jsonp",jsonp:"callback",data:{city_id:i.options.cityid,kw:i.nowkeyw,form:i.page},success:function(o){i.nowkeyw===t&&(e.isArray(o)?(i.suggest=o,i.content.hide(),i.elem.result.show(),i.bulidSuggest(o,t)):e.isArray(o.data)?(i.suggest=o.data,i.elem.content.hide(),i.elem.result.show(),i.buildSuggest(o.data,t)):e.isArray(o.data.match)&&(i.suggest=o.data,i.elem.content.hide(),i.elem.result.show(),i.buildSuggest(o.data,t)))},error:function(){console.log("error")}})},buildSuggest:function(t,i){var o=[],n=this;o.push('<li class="searchKey">'+this.nowkeyw+"</li>"),e.each(t.match,function(e,t){o.push(n.buildItem(t||{},i))}),this.elem.result.html(o.join(""))}}}(Zepto,book.search.component,"搜索模块"),function(e,t){var i=function(){var e=Math.floor(window.devicePixelRatio);return e=e>=2?1.5:1,i=function(){return e},e},o=function(){var e=new Image,t=!1;return e.onload=function(){t=!0},e.onerror=function(){T.trackEvent(APF.info.pageName+"_webp_support_error")},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA",o=function(){return t},t};t.LazyLoadImg=function(t){var i={min:0,max:-1,select:"img",attr:"data-src",ratioAttr:"origin",isClip:!1,imgRange:1};this.ops={},e.extend(this.ops,i,t),this.init()},t.LazyLoadImg.prototype={constructor:t.LazyLoadImg,init:function(){function t(){var t=e(window),i=o.ops.min,s=o.ops.max,r=t.height(),a=t.scrollTop();o.ops.min<a&&(i=a),(-1===o.ops.max||r*o.ops.imgRange+a<o.ops.max)&&(s=r*o.ops.imgRange+a),o.refreshImg(i,s),n=!1}function i(){n!==!0&&(n=!0,rAf(t))}var o=this,n=!1;rAf=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},e(window).scroll(i),e(document).on("touchmove",i),e(window).trigger("scroll")},refreshImg:function(t,i){var o,n=this;o=this.ops.select.replace(".",""),e(this.ops.select).each(function(s,r){var a=e(r);imgH=a.offset().top,imgH>=t&&i>=imgH&&(n.imgReplace(a,n.ops.attr,n.ops.ratioAttr,n.ops.isClip),a.removeClass(o))})},imgReplace:function(e,t,n,s){var r,a,c,l,u,h,p,d,g,m=t||"data-src",f=e.attr(m),n=n?e.data(n):!1;if(f){if(r=f.split("/").pop().match(/\d+x\d+/g)){if(n?(a=parseInt(e.parent().width(),10),c=parseInt(e.parent().height(),10),h=r[0].split("x"),p=parseInt(r[0],10),d=parseInt(r[1],10),u=d/p,u>c/a?a=parseInt(c/u,10):c=parseInt(a*u,10)):(a=parseInt(e.width(),10),c=parseInt(e.height(),10)),1>a||1>c)return;l=i();var w=a+"x"+c;s===!0&&(w+="c"),f=f.replace(r,Math.floor(a*l)+"x"+Math.floor(c*l))}f&&(g=new Image,g.onerror=function(){return!1},o()&&f&&/pic1\.ajkimg\.com(.*)\.(jpg|png)/.test(f)&&!(f.match(/\?t=(\d)/i)>0)&&(f+="?t=5"),g.onload=function(){e.attr("src",f)},g.src=f)}}}}(Zepto,BOOK.Namespace.register("module.utils")),function(e,t,i,o){t.Exposure=function(t){var n={trackTag:"data-trace",delay:50,pageName:o.info.pageName,prefix:"Exp_"};this.ops=e.extend(n,t),this.domCache=[],this.pageViewHeight=e(i).height(),this.timer=null,this.dataCache=[],this.expStatus=!1,this.init()},t.Exposure.prototype={constructor:t.Exposure,add:function(t){var o=this;this.expStatus=!0,t.each(function(t,i){o.domCache.push(e(i))}),e(i).scroll()},init:function(){var t=e(i);t.resize(e.proxy(this.resize,this)),t.on("beforeunload",e.proxy(this.beforeunload,this))},resize:function(){console.log("reszie"),this.pageViewHeight=e(i).height()},beforeunload:function(){this.buildData()},buildData:function(){}}}(Zepto,BOOK.Namespace.register("touch.component.module"),window,BOOK),function(e,t){{var i=touch.component.module,o=i.Exposure;i.Search}new module.utils.LazyLoadImg({select:".imglazyload"}),t.Home=function(e){this.options=e,this.search={},this.init()},t.Home.prototype={constructor:t.Home,init:function(){this.exposure=new o,this.bindSearchEvent(),this.swiper()},bindSearchEvent:function(){new book.search.component.SearchModule({target:{select:["#search"],event:"click"},suggest:this.options.suggest,searchurl:this.options.searchurl,cityid:this.options.city_id})},swiper:function(){e("#swiper-container").height(e(window).width()/2.67);new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,parallax:!0,speed:600})}}}(Zepto,BOOK.Namespace.register("touch.home"),"首页模块");